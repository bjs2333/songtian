(window.webpackJsonp=window.webpackJsonp||[]).push([[68],{1242:function(t,e,n){},1358:function(t,e,n){"use strict";n(1242)},1459:function(t,e,n){"use strict";n.r(e);var r=n(39),head=(n(55),n(80),n(209),n(32),n(874)),o=n.n(head),c=n(873),d=n.n(c),l=n(208),f=n.n(l),m={name:"SuppleMentary",mixins:[o.a,d.a,f.a],data:function(){return{title:this.$t("user.supplementary"),loading:!1,onUploadImage:!1,id:"",onUploadAttached:!1,dataList:[],isSubmit:!1,site_mode:"",isPaid:""}},computed:{forums:function(){return this.$store.state.site.info.attributes||{}},url:function(){return"/api"},imageTypeLimit:function(){return this.forums.set_attach?this.forums.set_attach.support_img_ext.split(",").map((function(t){return".".concat(t)})).join(","):""},attachedTypeLimit:function(){return this.forums.set_attach?this.forums.set_attach.support_file_ext.split(",").map((function(t){return".".concat(t)})).join(","):""},attachedSizeLimit:function(){return this.forums.set_attach?1024*this.forums.set_attach.support_max_size*1024:10485760}},mounted:function(){var t=this.$route.query.id;t&&(this.id=t),this.forums&&this.forums.set_site&&this.forums.set_site.site_mode&&(this.site_mode=this.forums.set_site.site_mode),this.getData()},methods:{registerConfirm:function(){this.isSubmit=!0;for(var t=this.dataList,i=0;i<t.length;i++)if(t[i].required){var e=new RegExp("^[ ]+$"),n=t[i].detail;if(!n||n.length<1||e.test(n))return this.$message.error("".concat(t[i].name,"不能为空")),"string"==typeof n&&(this.dataList[i].detail=""),void(this.isSubmit=!1)}this.submit()},onPostContentChange:function(t,e,n){var r=this;1===e.length?this.dataList[n].detail.push(e[0]):e.forEach((function(t){r.dataList[n].detail.push(t)}))},removeItem:function(t,e){this.dataList[e].detail.splice(t,1)},submit:function(){var t=this;this.isSubmit=!0;var e=this.dataList,n={data:[]};e.forEach((function(e){var o=Object(r.a)(e.detail),c="";2===e.type?(e.options.forEach((function(t){t.value===e.detail.value&&(t.checked=!0)})),c=JSON.stringify({options:e.options})):3===e.type?(e.options.forEach((function(t){-1!==e.detail.indexOf(t.value)&&(t.checked=!0)})),c=JSON.stringify({options:e.options})):c="string"===o?e.detail:JSON.stringify(e.detail),n.data.push({type:"user_sign_in",attributes:{sort:e.sort,name:e.name,id:e.id,user_id:t.id,type:e.type,fields_desc:e.fields_desc,type_desc:e.type_desc,required:e.required,fields_ext:c,remark:e.remark,status:e.status}})})),this.$store.dispatch("jv/post",[{_jv:{type:"user/signinfields"}},{data:n}]).then((function(data){t.getUserInfo()}))},getUserInfo:function(){var t=this,e=this.$store.getters["session/get"]("userId");this.$store.dispatch("jv/get",["users/".concat(e),{params:{include:"groups"}}]).then((function(e){e&&e.paid&&(t.isPaid=e.paid),""===t.site_mode?window.location.href="/":("pay"!==t.site_mode||t.isPaid)&&(t.isSubmit=!1,t.$router.push("/")),"pay"!==t.site_mode||t.isPaid||(t.isSubmit=!1,t.$router.push("/site/info"))})).catch((function(e){var n=e.response.data.errors;if(Array.isArray(n)&&n.length>0&&"register_validate"===n[0].code)return t.$store.commit("session/SET_AUDIT_INFO",{errorCode:"register_validate",username:n[0].data.userName}),void t.$router.push("/user/warning")}))},getData:function(){var t=this,e={user_id:this.id};this.$store.dispatch("jv/get",["user/signinfields",{params:e}]).then((function(e){e.forEach((function(t,i){!t.fields_ext||2!==t.type&&3!==t.type||(t.options=JSON.parse(t.fields_ext).options),t.detail=t.type>2?[]:""})),t.dataList=e}),(function(e){return t.handleError(e)}))}}},h=(n(1358),n(12)),component=Object(h.a)(m,(function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"supple"},[n("h2",{staticClass:"supple-title"},[t._v(t._s(t.$t("user.supplementary")))]),t._v(" "),t._l(t.dataList,(function(e,r){return n("div",{key:r,staticClass:"supple-content"},[n("div",{staticClass:"supple-content__item"},[n("div",{staticClass:"supple-content__item__title"},[t._v("\n        "+t._s(r+1+"."+e.name)+"\n        "),e.required?n("span",{staticClass:"supple-content__item__title-necessary"},[t._v("*\n        ")]):t._e()]),t._v(" "),n("div",{staticClass:"supple-content__item__detail"},[0===e.type?n("el-input",{attrs:{clearable:"",placeholder:t.$t("user.inputcontent")},model:{value:e.detail,callback:function(n){t.$set(e,"detail",n)},expression:"item.detail"}}):1===e.type?n("el-input",{attrs:{clearable:"",type:"textarea",autosize:{minRows:2,maxRows:4},placeholder:t.$t("user.inputcontent")},model:{value:e.detail,callback:function(n){t.$set(e,"detail",n)},expression:"item.detail"}}):2===e.type?n("el-radio-group",{model:{value:e.detail,callback:function(n){t.$set(e,"detail",n)},expression:"item.detail"}},t._l(e.options,(function(e){return n("el-radio",{key:e.value,attrs:{label:e}},[t._v(t._s(e.value)+"\n          ")])})),1):3===e.type?n("el-checkbox-group",{model:{value:e.detail,callback:function(n){t.$set(e,"detail",n)},expression:"item.detail"}},t._l(e.options,(function(t){return n("el-checkbox",{key:t.value,attrs:{label:t.value}})})),1):4===e.type?n("div",{staticClass:"supple-content__item__detail-image"},[n("image-upload",{attrs:{"on-upload":t.onUploadImage,type:1,"file-list":[],action:"/attachments",accept:t.imageTypeLimit,"size-limit":t.attachedSizeLimit},on:{"update:onUpload":function(e){t.onUploadImage=e},"update:on-upload":function(e){t.onUploadImage=e},success:function(e){return t.onPostContentChange("imageList",e,r)},remove:function(e,n){return t.removeItem(n,r)}}})],1):5===e.type?n("div",{staticClass:"supple-content__item__detail-file"},[n("attachment-upload",{attrs:{"file-list":[],"on-upload":t.onUploadAttached,action:"/attachments",accept:t.attachedTypeLimit,type:0,"size-limit":t.attachedSizeLimit,"add-tips":t.$t("post.postAttachment")},on:{"update:onUpload":function(e){t.onUploadAttached=e},"update:on-upload":function(e){t.onUploadAttached=e},success:function(e){return t.onPostContentChange("attachedList",e,r)},remove:function(e,n){return t.removeItem(n,r)}}})],1):t._e()],1)])])})),t._v(" "),n("el-button",{staticClass:"r-button",attrs:{type:"primary",disabled:t.isSubmit},on:{click:t.registerConfirm}},[t._v("\n    "+t._s(t.$t("modify.submit"))+"\n  ")])],2)}),[],!1,null,"4ca4e07e",null);e.default=component.exports;installComponents(component,{ImageUpload:n(1047).default,AttachmentUpload:n(1046).default})},873:function(t,e,n){var r=n(882);n(20),n(66),t.exports={data:function(){var t=this;return{errorCodeHandler:{default:{model_not_found:function(){return t.$router.replace("/error")},not_authenticated:function(){return t.$router.push("/user/login")}},thread:{permission_denied:function(){return t.$router.replace("/error?code=permissionDenied")}}}}},methods:{handleError:function(t){var e=arguments,n=this;return r(regeneratorRuntime.mark((function r(){var o,c,d,l,f,m;return regeneratorRuntime.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(o=e.length>1&&void 0!==e[1]?e[1]:"",c=t.response.data.errors,!(Array.isArray(c)&&c.length>0)){r.next=17;break}if(d=c[0].code,l=c[0].detail&&c[0].detail.length>0?c[0].detail[0]:c[0].code,f=c[0].detail&&c[0].detail.length>0?c[0].detail[0]:n.$t("core.".concat(l)),"site_closed"!==c[0].code){r.next=10;break}return r.next=9,n.siteClose(c);case 9:return r.abrupt("return",r.sent);case 10:if("need_ext_fields"!==c[0].code){r.next=14;break}return m=n.$store.getters["session/get"]("userId"),n.$router.push("/user/supple-mentary?id=".concat(m)),r.abrupt("return");case 14:"Permission Denied"===d?n.$message.error(n.$t("core.permission_denied2")):"content_banned_show_words"===d?n.$message.error(n.$t("core.content_banned_show_words")+c[0].detail):n.$message.error(f),n.errorCodeHandler.default[d]&&n.errorCodeHandler.default[d](),o&&n.errorCodeHandler[o][d]&&n.errorCodeHandler[o][d]();case 17:case"end":return r.stop()}}),r)})))()},siteClose:function(t){var e=this;return r(regeneratorRuntime.mark((function n(){return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.prev=0,n.next=3,e.$store.dispatch("forum/setError",{code:t[0].code,detail:t[0].detail&&t[0].detail.length>0&&t[0].detail[0]});case 3:return n.next=5,e.$router.push("/site/close");case 5:n.next=9;break;case 7:n.prev=7,n.t0=n.catch(0);case 9:case"end":return n.stop()}}),n,null,[[0,7]])})))()}}}},874:function(t,e){t.exports={data:function(){return{title:"‎"}},computed:{forums:function(){return this.$store.state.site.info.attributes||{}}},head:function(){return{title:"‎"!==this.title&&this.forums&&this.forums.set_site&&this.forums.set_site.site_name?"".concat(this.title," - ").concat(this.forums.set_site.site_name):this.title}}}},879:function(t,e){e.extensionList=["7Z","AI","APK","CAD","CDR","DOC","DOCX","EPS","EXE","IPA","MP3","MP4","PDF","PPT","PSD","RAR","TXT","XLS","XLSX","ZIP","JPG","WAV"]},882:function(t,e){function n(t,e,n,r,o,c,d){try{var l=t[c](d),f=l.value}catch(t){return void n(t)}l.done?e(f):Promise.resolve(f).then(r,o)}t.exports=function(t){return function(){var e=this,r=arguments;return new Promise((function(o,c){var d=t.apply(e,r);function l(t){n(d,o,c,l,f,"next",t)}function f(t){n(d,o,c,l,f,"throw",t)}l(void 0)}))}},t.exports.default=t.exports,t.exports.__esModule=!0}}]);